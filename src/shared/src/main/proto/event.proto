syntax = "proto3";

option java_multiple_files = true;
option java_package = "gov.nist.csd.pm.pdp.proto.event";

package gov.nist.csd.pm.pdp.proto.event;

message PMEvent {
  oneof event {
    AssignmentCreated assignment_created = 1;
    AssociationCreated association_created = 2;
    PolicyClassCreated policy_class_created = 3;
    UserAttributeCreated user_attribute_created = 4;
    ObjectAttributeCreated object_attribute_created = 5;
    UserCreated user_created = 6;
    ObjectCreated object_created = 7;
    AssignmentDeleted assignment_deleted = 8;
    NodeDeleted node_deleted = 9;
    AssociationDeleted association_deleted = 10;
    NodePropertiesSet node_properties_set = 11;

    ProhibitionCreated prohibition_created = 12;
    ProhibitionDeleted prohibition_deleted = 13;

    ObligationCreated obligation_created = 14;
    ObligationDeleted obligation_deleted = 15;

    OperationCreated operation_created = 16;
    OperationDeleted operation_deleted = 17;
    ResourceAccessRightsSet resource_access_rights_set = 18;
  }
}

message PMSnapshot {
  int64 revision = 1;
  string json = 2;
}

// graph
message AssignmentCreated {
  int64 ascendant = 1;
  repeated int64 descendants = 2;
}

message AssociationCreated {
  int64 ua = 1;
  int64 target = 2;
  repeated string arset = 3;
}

message PolicyClassCreated {
  int64 id = 1;
  string name = 2;
}

message UserAttributeCreated {
  int64 id = 1;
  string name = 2;
  repeated int64 descendants = 3;
}

message ObjectAttributeCreated {
  int64 id = 1;
  string name = 2;
  repeated int64 descendants = 3;
}

message UserCreated {
  int64 id = 1;
  string name = 2;
  repeated int64 descendants = 3;
}

message ObjectCreated {
  int64 id = 1;
  string name = 2;
  repeated int64 descendants = 3;
}

message AssignmentDeleted {
  int64 ascendant = 1;
  repeated int64 descendants = 2;
}

message NodeDeleted {
  int64 id = 1;
}

message AssociationDeleted {
  int64 ua = 1;
  int64 target = 2;
}

message NodePropertiesSet {
  int64 id = 1;
  map<string, string> properties = 2;
}

// prohibitions
message ProhibitionCreated {
  string name = 1;
  int64 node = 2;
  optional string process = 3;
  repeated string arset = 4;
  bool is_conjunctive = 5;
  repeated int64 inclusion_set = 6;
  repeated int64 exclusion_set = 7;
}

message ProhibitionDeleted {
  string name = 1;
}

// obligations
message ObligationCreated {
  int64 author = 1;
  string pml = 2;
}

message ObligationDeleted {
  string name = 1;
}

// operations
message OperationCreated {
  string pml = 1;
}

message OperationDeleted {
  string name = 1;
}

message ResourceAccessRightsSet {
  repeated string operations = 1;
}